<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ICS-PA心得 | My Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <link rel="alternate" type="application/atom+xml" href="https://kigane.github.io/atom.xml" title="My Blog Atom Feed">
    <link rel="alternate" type="application/json" href="https://kigane.github.io/feed.json" title="My Blog JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="https://kigane.github.io/rss.xml" title="My Blog RSS Feed">
    <link rel="icon" href="/favicon.ico">
    <link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512">
    <link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192">
    <link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512">
    <link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192">
    <link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials">
    <link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png">
    <meta name="description" content="想，都是问题。做，才是答案。">
    <meta property="og:url" content="/note/cs/ics-pa.html">
    <meta property="og:site_name" content="My Blog">
    <meta property="og:title" content="ICS-PA心得">
    <meta property="og:description" content="PA1 NEMU准备make ISA=$ISA run; 在cmdc()函数中, 调用cpuexec()的时候传入了参数-1，但参数类型是uint64_t,因此实际的值为$2^{64}-1$，即0xffffffffffffffff。; 三个对调试有用的宏(在nemu/include/debug.h中定义); Log()是printf()的升级版, 专">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="zh-CN">
    <meta property="og:locale:alternate" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="My Blog">
    <meta property="article:author" content="Leonhardt">
    <meta name="theme-color" content="#46bd87">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    
    <link rel="preload" href="/assets/css/0.styles.6a1d4d3d.css" as="style"><link rel="preload" href="/assets/js/app.e7b3748e.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.713d0a7b.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.d598e2f1.js" as="script"><link rel="preload" href="/assets/js/page-ICS-PA心得.c9458328.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.1d2b5365.js" as="script"><link rel="prefetch" href="/assets/js/68.ff319b59.js"><link rel="prefetch" href="/assets/js/69.9bfb6bd5.js"><link rel="prefetch" href="/assets/js/70.2009e35c.js"><link rel="prefetch" href="/assets/js/71.1a3038eb.js"><link rel="prefetch" href="/assets/js/layout-Blog.12ecf3dd.js"><link rel="prefetch" href="/assets/js/layout-Layout.196029ba.js"><link rel="prefetch" href="/assets/js/layout-NotFound.465ddc3f.js"><link rel="prefetch" href="/assets/js/layout-Slide.aa5769a3.js"><link rel="prefetch" href="/assets/js/page-BOMDOMEvent.ea19764f.js"><link rel="prefetch" href="/assets/js/page-BlogHome.0177d352.js"><link rel="prefetch" href="/assets/js/page-C++小知识.ee3b2aad.js"><link rel="prefetch" href="/assets/js/page-CC++文件IO.46e33f9a.js"><link rel="prefetch" href="/assets/js/page-CSS基础.6a213edd.js"><link rel="prefetch" href="/assets/js/page-CSS布局.087e9e28.js"><link rel="prefetch" href="/assets/js/page-CSS模块化.d5ba90fa.js"><link rel="prefetch" href="/assets/js/page-CSS预处理器.b2550712.js"><link rel="prefetch" href="/assets/js/page-CSS高级话题.f928ee71.js"><link rel="prefetch" href="/assets/js/page-CustomLayout.45392432.js"><link rel="prefetch" href="/assets/js/page-C语言.5cf4d6e2.js"><link rel="prefetch" href="/assets/js/page-DeeplearningincomputervisionAcriticalreviewofemergingtechniquesandapplicationscenarios.3b5626cc.js"><link rel="prefetch" href="/assets/js/page-Hazel.a7d8bcd4.js"><link rel="prefetch" href="/assets/js/page-HelloVuepress.c63152be.js"><link rel="prefetch" href="/assets/js/page-IntroPage.e9dd6418.js"><link rel="prefetch" href="/assets/js/page-JS基础.efbbc45e.js"><link rel="prefetch" href="/assets/js/page-JS对象.a853bfa8.js"><link rel="prefetch" href="/assets/js/page-JS小知识.f3705611.js"><link rel="prefetch" href="/assets/js/page-Linux-Ubantu.0512b263.js"><link rel="prefetch" href="/assets/js/page-Markdown增强.99fbf8dd.js"><link rel="prefetch" href="/assets/js/page-OpenCV.733dcc55.js"><link rel="prefetch" href="/assets/js/page-OpenGL基础.1f240b66.js"><link rel="prefetch" href="/assets/js/page-Projecthome.e9de463b.js"><link rel="prefetch" href="/assets/js/page-VuePress默认主题设置.f02236d2.js"><link rel="prefetch" href="/assets/js/page-Vuejs.baba1199.js"><link rel="prefetch" href="/assets/js/page-css小技巧.7166f14d.js"><link rel="prefetch" href="/assets/js/page-eigen库.9bfa1594.js"><link rel="prefetch" href="/assets/js/page-gdb.4671ff3a.js"><link rel="prefetch" href="/assets/js/page-git.0fd83320.js"><link rel="prefetch" href="/assets/js/page-i386.f9ffee93.js"><link rel="prefetch" href="/assets/js/page-katex常用写法.d2950258.js"><link rel="prefetch" href="/assets/js/page-python.f35c0cbd.js"><link rel="prefetch" href="/assets/js/page-riscv.d875edec.js"><link rel="prefetch" href="/assets/js/page-shell.36552705.js"><link rel="prefetch" href="/assets/js/page-vim.9369e045.js"><link rel="prefetch" href="/assets/js/page-名词解释.68120438.js"><link rel="prefetch" href="/assets/js/page-安装记录.3ce9c19b.js"><link rel="prefetch" href="/assets/js/page-宏.dbe9d5aa.js"><link rel="prefetch" href="/assets/js/page-密码加密的文章.a8feeeeb.js"><link rel="prefetch" href="/assets/js/page-导言.5573071c.js"><link rel="prefetch" href="/assets/js/page-帧缓冲(FrameBuffer).496e2fdb.js"><link rel="prefetch" href="/assets/js/page-异常控制流.53253656.js"><link rel="prefetch" href="/assets/js/page-我的博客.715b5fe4.js"><link rel="prefetch" href="/assets/js/page-数字图像处理.5f9c3f17.js"><link rel="prefetch" href="/assets/js/page-正则表达式.0617204d.js"><link rel="prefetch" href="/assets/js/page-游戏引擎总览.8ec30969.js"><link rel="prefetch" href="/assets/js/page-算法.fe978f29.js"><link rel="prefetch" href="/assets/js/page-组件禁用.5e0c1e5d.js"><link rel="prefetch" href="/assets/js/page-编译器相关.4ca25840.js"><link rel="prefetch" href="/assets/js/page-虚拟内存.9f176d70.js"><link rel="prefetch" href="/assets/js/page-计算机概述.d96ae10e.js"><link rel="prefetch" href="/assets/js/page-资源与工具.2d6a2015.js"><link rel="prefetch" href="/assets/js/page-软件渲染器.3b90a7d7.js"><link rel="prefetch" href="/assets/js/page-随机数.35cbaa5b.js"><link rel="prefetch" href="/assets/js/page-页面配置.4730d733.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.08c1a9f2.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.3594d729.js"><link rel="prefetch" href="/assets/js/vendors~reveal.feb39742.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6a1d4d3d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/" class="home-link router-link-active"><img src="/link.png" alt="My Blog" class="logo"> <!----> <span class="site-name can-hide">My Blog</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  Home
</a></div><div class="nav-item"><a href="/home/" class="nav-link"><i class="iconfont icon-home"></i>
  Project Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link"><i class="iconfont icon-creative"></i>
  Guide
</a></div><div class="nav-item"><a href="/blog/" class="nav-link"><i class="iconfont icon-blog"></i>
  Blog
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Note" class="dropdown-title"><span class="title"><i class="iconfont icon-note"></i>
        Note
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/note/algorithm/" class="nav-link"><!---->
  Algorithm
</a></li><li class="dropdown-item"><a href="/note/cs/" class="nav-link router-link-active active"><!---->
  Computer Science
</a></li><li class="dropdown-item"><a href="/note/cv/" class="nav-link"><!---->
  Computer Vision
</a></li><li class="dropdown-item"><a href="/note/cpp/" class="nav-link"><!---->
  C/C++
</a></li><li class="dropdown-item"><a href="/note/dip/" class="nav-link"><!---->
  DIP
</a></li><li class="dropdown-item"><a href="/note/opengl/" class="nav-link"><!---->
  OpenGL
</a></li><li class="dropdown-item"><a href="/note/js/" class="nav-link"><!---->
  JavaScript
</a></li></ul></div></div><div class="nav-item"><a href="/hazel/" class="nav-link"><!---->
  Hazel
</a></div></nav> <!----> <a rel="noopener noreferrer" href="https://github.com/kigane/HopeBlog" target="_blank" class="repo-link can-hide">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div vocab="https://schema.org/" typeof="Person" class="blogger-info mobile"><div data-balloon-pos="down" role="navigation" class="blogger hasIntro"><img property="image" alt="Blogger Avatar" src="/link.png" class="avatar round"> <div property="name" class="name">Leonhardt</div> <meta property="url" content="/intro/"></div> <div class="num-wrapper"><div><div class="num">54</div> <div>Articles</div></div> <div><div class="num">5</div> <div>Category</div></div> <div><div class="num">8</div> <div>Tags</div></div> <div><div class="num">54</div> <div>Timeline</div></div></div> <div class="media-links-wrapper"><a href="https://zhihu.com" rel="noopener noreferrer" target="_blank" aria-label="Zhihu" data-balloon-pos="up" class="media-link"><span class="sr-only">Zhihu</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-zhihu"><circle cx="512" cy="512" r="512" fill="#006CE2"></circle> <path d="M513.65 491.261H411.551c1.615-16.154 5.815-60.095 5.815-84.973 0-24.88-.323-60.742-.323-60.742h102.744V329.39c0-21.647-9.37-31.34-17.124-31.34h-178.67s5.169-17.77 10.015-36.186c4.846-18.417 15.832-44.264 15.832-44.264-63.003 4.2-67.958 50.941-81.743 92.729-13.787 41.785-24.556 62.356-44.586 107.912 27.786 0 55.249-13.57 66.879-32.309 11.631-18.74 16.908-40.71 16.908-40.71h62.035v59.019c0 21.107-3.878 87.45-3.878 87.45H254.742c-19.386 0-29.724 48.894-29.724 48.894h133.76c-8.4 75.82-26.493 106.191-51.91 152.716-25.418 46.525-92.728 99.406-92.728 99.406 41.033 11.63 86.589-3.555 105.974-21.972 19.386-18.417 35.863-49.756 47.817-72.838 11.954-23.081 21.972-65.124 21.972-65.124L498.462 766.86s4.846-24.233 6.461-39.418c1.616-15.186-.755-26.385-4.63-35.433-3.878-9.046-15.509-21.54-31.018-39.634-15.507-18.094-48.034-52.879-48.034-52.879s-15.832 11.63-28.108 21.001c9.046-21.97 16.262-79.695 16.262-79.695h122.343v-20.249c.003-17.66-7.319-29.29-18.089-29.29zm287.337-200.747h-234.35a4.308 4.308 0 0 0-4.309 4.308v435.099a4.308 4.308 0 0 0 4.308 4.308h40.226l14.7 50.402 81.096-50.402h98.328a4.308 4.308 0 0 0 4.308-4.308v-435.1a4.308 4.308 0 0 0-4.308-4.308zM755.97 684.47h-52.343l-61.548 39.095-10.823-39.095h-18.738V338.116H755.97v346.355z" fill="#FFF"></path></svg></a><a href="https://baidu.com" rel="noopener noreferrer" target="_blank" aria-label="Baidu" data-balloon-pos="up" class="media-link"><span class="sr-only">Baidu</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-baidu"><circle cx="512" cy="512" r="512" fill="#1D2FE3"></circle> <path d="M239.022 704.978c.098-4.865-.314-9.772.162-14.591 5.178-52.464 197.571-253.377 249.641-259.233 42.996-4.833 75.768 16.545 99.824 49.144 37.893 51.351 82.81 95.455 131.292 136.237 52.903 44.503 56.525 99.801 32.6 158.592-23.425 57.56-75.34 69.833-127.771 58.804-84.971-17.874-168.158-13.744-253.37-4.536-86.35 9.333-133.788-39.4-132.378-124.417zM352.464 412.86c-3.58 50.707-17.93 96.128-75.9 98.12-58.053 1.995-80.093-41.432-79.275-91.71.81-49.705 13.416-104.053 76.851-102.136 53.84 1.625 74.74 45.8 78.324 95.726zm386.053 142.168c-68.494-1.735-84.188-43.331-82.635-93.812 1.46-47.519 10.082-97.628 73.299-96.65 61.395.95 81.6 43.207 81.553 98.668-.047 53.156-19.818 89.398-72.217 91.794zm-45.235-278.345c-10.464 42.665-24.513 91.761-85.919 94.502-52.74 2.354-71.705-34.482-72.805-81.242-1.233-52.42 48.08-112.965 87.582-110.373 33.943 2.226 71.146 49.541 71.142 97.113zm-195.147-14.097c-7.005 46.274-13.63 100.025-71.562 101.351-57.077 1.306-73.567-47.922-73.638-97.109-.068-48.054 12.128-99.024 69.345-101.426 59.45-2.493 67.11 51.093 75.855 97.184z" fill="#fff"></path> <path d="M479.52 663.165c.006 12.194 1.498 24.61-.284 36.537-4.707 31.503 18.862 78.749-45.326 77.534-54.226-1.027-103.338-3.31-113.231-73.536-7.164-50.852 7.78-85.674 57.687-102.668 17.67-6.016 39.618 5.058 54.096-14.548 10.84-14.679-2.901-54.592 33.418-41.47 24.075 8.7 11.477 38.922 13.278 59.652 1.68 19.366.359 38.99.363 58.5zm175.45 41.902c4.291 39.657 5.093 78.047-64.709 73.503-60.097-3.912-95.56-20.794-86.293-85.624 4.287-29.991-21.148-83.238 22.19-84.867 42.71-1.606 13.57 50.41 20.825 77.622 5.276 19.794-3.984 46.774 29.753 48.193 41.337 1.738 28.383-30.022 31.099-51.604 1.209-9.61-.85-19.65.528-29.215 2.516-17.474-8.928-44.716 19.554-47.191 36.044-3.133 24.155 28.376 26.678 47.523 1.896 14.387.375 29.225.375 51.66z" fill="#1D2FE3"></path> <path d="M435.669 685.038c-2.255 24.07 5.605 53.68-33.623 52.136-34.594-1.362-35.274-31.818-38.513-53.078-4.028-26.448 11.38-48.18 40.785-50.023 40.967-2.564 27.097 30.764 31.35 50.965z" fill="#fff"></path></svg></a><a href="https://github.com" rel="noopener noreferrer" target="_blank" aria-label="Github" data-balloon-pos="up" class="media-link"><span class="sr-only">Github</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-github"><circle cx="512" cy="512" r="512" fill="#171515"></circle> <path d="M509.423 146.442c-200.317 0-362.756 162.42-362.756 362.8 0 160.266 103.936 296.24 248.109 344.217 18.139 3.327 24.76-7.872 24.76-17.486 0-8.613-.313-31.427-.49-61.702-100.912 21.923-122.205-48.63-122.205-48.63-16.495-41.91-40.28-53.067-40.28-53.067-32.937-22.51 2.492-22.053 2.492-22.053 36.407 2.566 55.568 37.386 55.568 37.386 32.362 55.438 84.907 39.43 105.58 30.143 3.296-23.444 12.667-39.43 23.032-48.498-80.557-9.156-165.246-40.28-165.246-179.297 0-39.604 14.135-71.988 37.342-97.348-3.731-9.178-16.18-46.063 3.556-96.009 0 0 30.46-9.754 99.76 37.19 28.937-8.048 59.97-12.071 90.823-12.211 30.807.14 61.843 4.165 90.822 12.21 69.26-46.944 99.663-37.189 99.663-37.189 19.792 49.946 7.34 86.831 3.61 96.01 23.25 25.359 37.29 57.742 37.29 97.347 0 139.366-84.82 170.033-165.637 179.013 13.026 11.2 24.628 33.342 24.628 67.182 0 48.498-.445 87.627-.445 99.521 0 9.702 6.535 20.988 24.945 17.444 144.03-48.067 247.881-183.95 247.881-344.175 0-200.378-162.442-362.798-362.802-362.798z" fill="#FFF"></path></svg></a></div></div> <hr> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  Home
</a></div><div class="nav-item"><a href="/home/" class="nav-link"><i class="iconfont icon-home"></i>
  Project Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link"><i class="iconfont icon-creative"></i>
  Guide
</a></div><div class="nav-item"><a href="/blog/" class="nav-link"><i class="iconfont icon-blog"></i>
  Blog
</a></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="Note" class="dropdown-title"><span class="title"><i class="iconfont icon-note"></i>
      Note
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/algorithm/" class="nav-link"><!---->
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/note/cs/" class="nav-link router-link-active active"><!---->
  Computer Science
</a></li><li class="dropdown-item"><!----> <a href="/note/cv/" class="nav-link"><!---->
  Computer Vision
</a></li><li class="dropdown-item"><!----> <a href="/note/cpp/" class="nav-link"><!---->
  C/C++
</a></li><li class="dropdown-item"><!----> <a href="/note/dip/" class="nav-link"><!---->
  DIP
</a></li><li class="dropdown-item"><!----> <a href="/note/opengl/" class="nav-link"><!---->
  OpenGL
</a></li><li class="dropdown-item"><!----> <a href="/note/js/" class="nav-link"><!---->
  JavaScript
</a></li></ul></div></div><div class="nav-item"><a href="/hazel/" class="nav-link"><!---->
  Hazel
</a></div> <a rel="noopener noreferrer" href="https://github.com/kigane/HopeBlog" target="_blank" class="repo-link">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><a href="/note/cs/" aria-current="page" class="sidebar-link">计算机概述</a></li><li><a href="/note/cs/isa-i386/" class="sidebar-link">i386</a></li><li><a href="/note/cs/isa-riscv/" class="sidebar-link">riscv</a></li><li><a href="/note/cs/gdb-cheatsheet/" class="sidebar-link">gdb</a></li><li><a href="/note/cs/shell-cheatsheet/" class="sidebar-link">shell</a></li><li><a href="/note/cs/vim/" class="sidebar-link">vim</a></li><li><a href="/note/cs/git/" class="sidebar-link">git</a></li><li><a href="/note/cs/regex/" class="sidebar-link">正则表达式</a></li><li><a href="/note/cs/linux/" class="sidebar-link">Linux - Ubantu</a></li><li><a href="/note/cs/ECF/" class="sidebar-link">异常控制流</a></li><li><a href="/note/cs/VM/" class="sidebar-link">虚拟内存</a></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb"><ol vocab="https://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a href="/note/cs/" property="item" typeof="WebPage" class="router-link-active"><!----> <span property="name">计算机概述</span></a> <meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem" class="is-active"><a href="/note/cs/ics-pa/" aria-current="page" property="item" typeof="WebPage" class="router-link-exact-active router-link-active"><!----> <span property="name">ICS-PA心得</span></a> <meta property="position" content="2"></li></ol></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">ICS-PA心得</span></h1> <div class="page-info"><!----> <!----><!----><span aria-label="Writing Date📅" data-balloon-pos="down" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2021-10-3</span></span><!----><!----><span aria-label="Reading Time⌛" data-balloon-pos="down" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>About 9 min</span> <meta property="timeRequired" content="PT9M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/note/cs/ics-pa/#pa1" class="anchor-link heading2"><div>PA1</div></a></li><li class="anchor"><a href="/note/cs/ics-pa/#nemu准备" class="anchor-link heading3"><div>NEMU准备</div></a></li><li class="anchor"><a href="/note/cs/ics-pa/#如何调试" class="anchor-link heading3"><div>如何调试</div></a></li><li class="anchor"><a href="/note/cs/ics-pa/#一条指令在nemu中的执行过程" class="anchor-link heading3"><div>一条指令在NEMU中的执行过程</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h2 id="pa1"><a href="#pa1" class="header-anchor">#</a> PA1</h2> <h3 id="nemu准备"><a href="#nemu准备" class="header-anchor">#</a> NEMU准备</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>nemu
├── include                    # 存放全局使用的头文件
│   ├── common<span class="token punctuation">.</span>h               # 公用的头文件
│   ├── cpu
│   │   ├── decode<span class="token punctuation">.</span>h           # 译码相关
│   │   └── exec<span class="token punctuation">.</span>h             # 执行相关
│   ├── debug<span class="token punctuation">.</span>h                # 一些方便调试用的宏
│   ├── device                 # 设备相关
│   ├── isa                    # <span class="token constant">ISA</span>相关
│   ├── isa<span class="token punctuation">.</span>h                  # <span class="token constant">ISA</span>相关
│   ├── macro<span class="token punctuation">.</span>h                # 一些方便的宏定义
│   ├── memory                 # 访问内存相关
│   ├── monitor
│   │   ├── log<span class="token punctuation">.</span>h              # 日志文件相关
│   │   └── monitor<span class="token punctuation">.</span>h
│   └── rtl
│       ├── pesudo<span class="token punctuation">.</span>h           # <span class="token constant">RTL</span>伪指令
│       └── rtl<span class="token punctuation">.</span>h              # <span class="token constant">RTL</span>指令相关定义
├── Makefile                   # 指示<span class="token constant">NEMU</span>的编译和链接
├── Makefile<span class="token punctuation">.</span>git               # git版本控制相关
├── runall<span class="token punctuation">.</span>sh                  # 一键测试脚本
└── src                        # 源文件
    ├── device                 # 设备相关
    ├── engine
    │   └── interpreter        # 解释器的实现
    ├── isa                    # <span class="token constant">ISA</span>相关的实现
    │   ├── mips32
    │   ├── riscv32
    │   ├── riscv64
    │   └── x86
    ├── main<span class="token punctuation">.</span>c                 # 你知道的<span class="token operator">...</span>
    ├── memory
    │   └── paddr<span class="token punctuation">.</span>c            # 物理内存访问
    └── monitor
        ├── cpu<span class="token operator">-</span>exec<span class="token punctuation">.</span>c         # 指令执行的主循环
        ├── debug              # 简易调试器相关
        │   ├── expr<span class="token punctuation">.</span>c         # 表达式求值的实现
        │   ├── log<span class="token punctuation">.</span>c          # 日志文件相关
        │   ├── ui<span class="token punctuation">.</span>c           # 用户界面相关
        │   └── watchpoint<span class="token punctuation">.</span>c   # 监视点的实现
        └── monitor<span class="token punctuation">.</span>c
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><ul><li>make ISA=$ISA run</li> <li>在cmd_c()函数中, 调用cpu_exec()的时候传入了参数-1，但参数类型是uint64_t,因此实际的值为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>64</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2^{64}-1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">64</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>，即0xffffffffffffffff。</li> <li>三个对调试有用的宏(在nemu/include/debug.h中定义)
<ul><li>Log()是printf()的升级版, 专门用来输出调试信息, 同时还会输出使用Log()所在的源文件, 行号和函数. 当输出的调试信息过多的时候, 可以很方便地定位到代码中的相关位置</li> <li>Assert()是assert()的升级版, 当测试条件为假时, 在assertion fail之前可以输出一些信息</li> <li>panic()用于输出信息并结束程序, 相当于无条件的assertion fail</li></ul></li> <li>内存通过在nemu/src/memory/paddr.c中定义的大数组pmem来模拟. 在客户程序运行的过程中, 总是使用vaddr_read()和vaddr_write() (在nemu/include/memory/vaddr.h中定义)来访问模拟的内存. vaddr, paddr分别代表虚拟地址和物理地址.</li> <li>&quot;单元&quot;是指有独立含义的子串, 它们正式的称呼叫token.</li> <li>\33 即 ESC。</li> <li>makefile中使用awk，因为makefile中<code>$</code>会被特殊对待，所以awk的program text中的<code>$</code>要用<code>$$</code>表示。注意awk的action要写在<code>{}</code>中。</li> <li>fopen文件路径，在nemu目录下make run时，当前目录就是nemu。</li> <li>超级经典错误，if (tokens[p].type = '*')。。。。少写个等号</li> <li>strncpy(dest, src, n) 如果n个字符中没有'\0'，dest中不会主动加。如果dest中原来字符数大于n,则复制后要使src==dest，需要手动添加'\0'(dest[n] = '\0')</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>expr<span class="token operator">&gt;</span> <span class="token operator">:</span><span class="token operator">:</span><span class="token operator">=</span> <span class="token operator">&lt;</span>number<span class="token operator">&gt;</span>    # 一个数是表达式
  <span class="token operator">|</span> <span class="token string">&quot;(&quot;</span> <span class="token operator">&lt;</span>expr<span class="token operator">&gt;</span> <span class="token string">&quot;)&quot;</span>     # 在表达式两边加个括号也是表达式
  <span class="token operator">|</span> <span class="token operator">&lt;</span>expr<span class="token operator">&gt;</span> <span class="token string">&quot;+&quot;</span> <span class="token operator">&lt;</span>expr<span class="token operator">&gt;</span>  # 两个表达式相加也是表达式
  <span class="token operator">|</span> <span class="token operator">&lt;</span>expr<span class="token operator">&gt;</span> <span class="token string">&quot;-&quot;</span> <span class="token operator">&lt;</span>expr<span class="token operator">&gt;</span>  # 接下来你全懂了
  <span class="token operator">|</span> <span class="token operator">&lt;</span>expr<span class="token operator">&gt;</span> <span class="token string">&quot;*&quot;</span> <span class="token operator">&lt;</span>expr<span class="token operator">&gt;</span>
  <span class="token operator">|</span> <span class="token operator">&lt;</span>expr<span class="token operator">&gt;</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">&lt;</span>expr<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="如何调试"><a href="#如何调试" class="header-anchor">#</a> 如何调试</h3> <p>一些软件工程相关的概念:</p> <ul><li>Fault: 实现错误的代码, 例如if (p = NULL)</li> <li>Error: 程序执行时不符合预期的状态, 例如p被错误地赋值成NULL</li> <li>Failure: 能直接观测到的错误, 例如程序触发了段错误</li></ul> <p>调试其实就是从观测到的failure一步一步回溯寻找fault的过程, 找到了fault之后, 我们就很快知道应该如何修改错误的代码了. 但从上面的例子也可以看出, 调试之所以不容易, 恰恰是因为:</p> <ul><li>fault不一定马上触发error</li> <li>触发了error也不一定马上转变成可观测的failure</li> <li>error会像滚雪球一般越积越多, 当我们观测到failure的时候, 其实已经距离fault非常遥远了</li></ul> <p>理解了这些原因之后, 我们就可以制定相应的策略了:</p> <ul><li>尽可能把fault转变成error. 这其实就是测试做的事情, 所以我们在上一节中加入了表达式生成器的内容, 来帮助大家进行测试, 后面的实验内容也会提供丰富的测试用例. 但并不是有了测试用例就能把所有fault都转变成error了, 因为这取决于测试的覆盖度. 要设计出一套全覆盖的测试并不是一件简单的事情, 越是复杂的系统, 全覆盖的测试就越难设计. 但是, 如何提高测试的覆盖度, 是学术界一直以来都在关注的问题.</li> <li>尽早观测到error的存在. 观测到error的时机直接决定了调试的难度: 如果等到触发failure的时候才发现error的存在, 调试就会比较困难; 但如果能在error刚刚触发的时候就观测到它, 调试难度也就大大降低了. 事实上, 你已经见识过一些有用的工具了:
<ul><li>-Wall, -Werror: 在编译时刻把潜在的fault直接转变成failure. 这种工具的作用很有限, 只能寻找一些在编译时刻也觉得可疑的fault, 例如if (p = NULL). 不过随着编译器版本的增强, 编译器也能发现代码中的一些未定义行为. 这些都是免费的午餐, 不吃就真的白白浪费了.</li> <li>assert(): 在运行时刻把error直接转变成failure. assert()是一个很简单却又非常强大的工具, 只要在代码中定义好程序应该满足的特征, 就一定能在运行时刻将不满足这些特征的error拦截下来. 例如链表的实现, 我们只需要在代码中插入一些很简单的assert()(例如指针解引用时不为空), 就能够几乎告别段错误. 但是, 编写这些assert()其实需要我们对程序的行为有一定的了解, 同时在程序特征不易表达的时候, assert()的作用也较为有限.</li> <li>printf(): 通过输出的方式观察潜在的error. 这是用于回溯fault时最常用的工具, 用于观测程序中的变量是否进入了错误的状态. 在NEMU中我们提供了输出更多调试信息的宏Log(), 它实际上封装了printf()的功能. 但由于printf()需要根据输出的结果人工判断是否正确, 在便利程度上相对于assert()的自动判断就逊色了不少.</li> <li>GDB: 随时随地观测程序的任何状态. 调试器是最强大的工具, 但你需要在程序行为的茫茫大海中观测那些可疑的状态, 因此使用起来的代价也是最大的.</li></ul></li></ul> <p>建议:</p> <ul><li>总是使用-Wall和-Werror</li> <li>尽可能多地在代码中插入assert()</li> <li>assert()无法捕捉到error时, 通过printf()输出可疑的变量, 期望能观测到error</li> <li>printf()不易观测error时, 通过GDB理解程序的精确行为</li></ul> <h3 id="一条指令在nemu中的执行过程"><a href="#一条指令在nemu中的执行过程" class="header-anchor">#</a> 一条指令在NEMU中的执行过程</h3> <p>事实上, 一个字节最多只能区分256种不同的指令形式. 当指令形式的数目大于256时, 我们需要使用另外的方法来识别它们. x86中有主要有两种方法来解决这个问题(在PA2中你都会遇到这两种情况):</p> <ul><li>一种方法是使用转义码(escape code), x86中有一个2字节转义码 0x0f, 当指令opcode的第一个字节是0x0f时, 表示需要再读入一个字节才能决定具体的指令形式(部分条件跳转指令就属于这种情况). 后来随着各种SSE指令集的加入, 使用2字节转义码也不足以表示所有的指令形式了, x86在2字节转义码的基础上又引入了3字节转义码, 当指令opcode的前两个字节是0x0f和0x38时, 表示需要再读入一个字节才能决定具体的指令形式.</li> <li>另一种方法是使用ModR/M字节中的扩展opcode域来对opcode的长度进行扩充. 有些时候, 读入一个字节也还不能完全确定具体的指令形式, 这时候需要读入紧跟在opcode后面的ModR/M字节, 把其中的reg/opcode域当做opcode的一部分来解释, 才能决定具体的指令形式. x86把这些指令划分成不同的指令组(instruction group), 在同一个指令组中的指令需要通过ModR/M字节中的扩展opcode域来区分.</li></ul> <p>最一般的寻址格式是<br>
displacement(R[base_reg], R[index_reg], scale_factor)<br>
相应内存地址的计算方式为<br>
addr = R[base_reg] + R[index_reg] * scale_factor + displacement<br>
其它寻址格式都可以看作这种一般格式的特例</p> <p>在NEMU中, RTL寄存器只有以下这些</p> <ul><li>不同ISA的通用寄存器(在nemu/include/isa/$ISA.h中定义)</li> <li>id_src, id_src2和id_dest中的操作数内容val(在nemu/include/cpu/decode.h中定义).</li> <li>临时寄存器s0, s1, s2和t0(在nemu/include/rtl/rtl.h中定义)</li> <li>零寄存器rz(在nemu/src/monitor/cpu-exec.c中定义), 它的值总是0</li> <li>x86的ISA相关译码信息中的内存基地址mbr</li></ul> <p>RTL基本指令包括(我们使用了一些简单的正则表达式记号):</p> <ul><li>寄存器-寄存器类型和寄存器-立即数类型的基本算术/逻辑运算, 包括rtl_(add|sub|and|or|xor|shl|shr|sar|setrelop)i?, 它们的定义用到了nemu/src/engine/interpreter/c_op.h中的C语言运算和interpret_relop()函数</li> <li>寄存器-寄存器类型的乘除法运算, 包括rtl_i?(mul_[lo|hi]|div_[q|r]),</li> <li>被除数为64位的除法运算rtl_i?div64_[q|r]</li> <li>guest内存访问rtl_lm, rtl_lms和rtl_sm</li> <li>host内存访问rtl_host_lm和rtl_host_sm</li> <li>跳转, 包括直接跳转rtl_j, 间接跳转rtl_jr和条件跳转rtl_jrelop</li> <li>终止程序rtl_exit(在nemu/src/monitor/cpu-exec.c中定义)</li></ul> <p>小型调用约定:</p> <ul><li>实现RTL伪指令的时候, 尽可能不使用dest之外的寄存器存放中间结果. 由于dest最后会被写入新值, 其旧值肯定要被覆盖, 自然也可以安全地作为RTL伪指令的临时寄存器.</li> <li>实在需要使用临时寄存器的时候, 按照以下约定来使用:</li> <li>t0, t1, ... - 只能在RTL伪指令的实现过程中存放中间结果</li> <li>s0, s1, ... - 只能在译码辅助函数和执行辅助函数的实现过程中存放中间结果</li></ul> <p>RTL寄存器的生存期</p> <p>任何指令都可以分解为以下4中操作</p> <ul><li>读取某一主存单元的内容，并将其装入某个寄存器（取指， 取数）</li> <li>把一个数据从某个寄存器存入给定的主存单元中（存结果）</li> <li>把一个数据从某寄存器送到另一寄存器或者ALU（取数，存结果）</li> <li>进行算术或逻辑运算（PC+”1”，计算地址，运算）</li></ul></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><!----> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">2021年10月3日 10:18</span></div> <!----></footer> <!----> <!----> <!----> <div class="content__page-bottom"></div></main> <footer class="footer-wrapper"><div class="media-links-wrapper"><a href="https://zhihu.com" rel="noopener noreferrer" target="_blank" aria-label="Zhihu" data-balloon-pos="up" class="media-link"><span class="sr-only">Zhihu</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-zhihu"><circle cx="512" cy="512" r="512" fill="#006CE2"></circle> <path d="M513.65 491.261H411.551c1.615-16.154 5.815-60.095 5.815-84.973 0-24.88-.323-60.742-.323-60.742h102.744V329.39c0-21.647-9.37-31.34-17.124-31.34h-178.67s5.169-17.77 10.015-36.186c4.846-18.417 15.832-44.264 15.832-44.264-63.003 4.2-67.958 50.941-81.743 92.729-13.787 41.785-24.556 62.356-44.586 107.912 27.786 0 55.249-13.57 66.879-32.309 11.631-18.74 16.908-40.71 16.908-40.71h62.035v59.019c0 21.107-3.878 87.45-3.878 87.45H254.742c-19.386 0-29.724 48.894-29.724 48.894h133.76c-8.4 75.82-26.493 106.191-51.91 152.716-25.418 46.525-92.728 99.406-92.728 99.406 41.033 11.63 86.589-3.555 105.974-21.972 19.386-18.417 35.863-49.756 47.817-72.838 11.954-23.081 21.972-65.124 21.972-65.124L498.462 766.86s4.846-24.233 6.461-39.418c1.616-15.186-.755-26.385-4.63-35.433-3.878-9.046-15.509-21.54-31.018-39.634-15.507-18.094-48.034-52.879-48.034-52.879s-15.832 11.63-28.108 21.001c9.046-21.97 16.262-79.695 16.262-79.695h122.343v-20.249c.003-17.66-7.319-29.29-18.089-29.29zm287.337-200.747h-234.35a4.308 4.308 0 0 0-4.309 4.308v435.099a4.308 4.308 0 0 0 4.308 4.308h40.226l14.7 50.402 81.096-50.402h98.328a4.308 4.308 0 0 0 4.308-4.308v-435.1a4.308 4.308 0 0 0-4.308-4.308zM755.97 684.47h-52.343l-61.548 39.095-10.823-39.095h-18.738V338.116H755.97v346.355z" fill="#FFF"></path></svg></a><a href="https://baidu.com" rel="noopener noreferrer" target="_blank" aria-label="Baidu" data-balloon-pos="up" class="media-link"><span class="sr-only">Baidu</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-baidu"><circle cx="512" cy="512" r="512" fill="#1D2FE3"></circle> <path d="M239.022 704.978c.098-4.865-.314-9.772.162-14.591 5.178-52.464 197.571-253.377 249.641-259.233 42.996-4.833 75.768 16.545 99.824 49.144 37.893 51.351 82.81 95.455 131.292 136.237 52.903 44.503 56.525 99.801 32.6 158.592-23.425 57.56-75.34 69.833-127.771 58.804-84.971-17.874-168.158-13.744-253.37-4.536-86.35 9.333-133.788-39.4-132.378-124.417zM352.464 412.86c-3.58 50.707-17.93 96.128-75.9 98.12-58.053 1.995-80.093-41.432-79.275-91.71.81-49.705 13.416-104.053 76.851-102.136 53.84 1.625 74.74 45.8 78.324 95.726zm386.053 142.168c-68.494-1.735-84.188-43.331-82.635-93.812 1.46-47.519 10.082-97.628 73.299-96.65 61.395.95 81.6 43.207 81.553 98.668-.047 53.156-19.818 89.398-72.217 91.794zm-45.235-278.345c-10.464 42.665-24.513 91.761-85.919 94.502-52.74 2.354-71.705-34.482-72.805-81.242-1.233-52.42 48.08-112.965 87.582-110.373 33.943 2.226 71.146 49.541 71.142 97.113zm-195.147-14.097c-7.005 46.274-13.63 100.025-71.562 101.351-57.077 1.306-73.567-47.922-73.638-97.109-.068-48.054 12.128-99.024 69.345-101.426 59.45-2.493 67.11 51.093 75.855 97.184z" fill="#fff"></path> <path d="M479.52 663.165c.006 12.194 1.498 24.61-.284 36.537-4.707 31.503 18.862 78.749-45.326 77.534-54.226-1.027-103.338-3.31-113.231-73.536-7.164-50.852 7.78-85.674 57.687-102.668 17.67-6.016 39.618 5.058 54.096-14.548 10.84-14.679-2.901-54.592 33.418-41.47 24.075 8.7 11.477 38.922 13.278 59.652 1.68 19.366.359 38.99.363 58.5zm175.45 41.902c4.291 39.657 5.093 78.047-64.709 73.503-60.097-3.912-95.56-20.794-86.293-85.624 4.287-29.991-21.148-83.238 22.19-84.867 42.71-1.606 13.57 50.41 20.825 77.622 5.276 19.794-3.984 46.774 29.753 48.193 41.337 1.738 28.383-30.022 31.099-51.604 1.209-9.61-.85-19.65.528-29.215 2.516-17.474-8.928-44.716 19.554-47.191 36.044-3.133 24.155 28.376 26.678 47.523 1.896 14.387.375 29.225.375 51.66z" fill="#1D2FE3"></path> <path d="M435.669 685.038c-2.255 24.07 5.605 53.68-33.623 52.136-34.594-1.362-35.274-31.818-38.513-53.078-4.028-26.448 11.38-48.18 40.785-50.023 40.967-2.564 27.097 30.764 31.35 50.965z" fill="#fff"></path></svg></a><a href="https://github.com" rel="noopener noreferrer" target="_blank" aria-label="Github" data-balloon-pos="up" class="media-link"><span class="sr-only">Github</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-github"><circle cx="512" cy="512" r="512" fill="#171515"></circle> <path d="M509.423 146.442c-200.317 0-362.756 162.42-362.756 362.8 0 160.266 103.936 296.24 248.109 344.217 18.139 3.327 24.76-7.872 24.76-17.486 0-8.613-.313-31.427-.49-61.702-100.912 21.923-122.205-48.63-122.205-48.63-16.495-41.91-40.28-53.067-40.28-53.067-32.937-22.51 2.492-22.053 2.492-22.053 36.407 2.566 55.568 37.386 55.568 37.386 32.362 55.438 84.907 39.43 105.58 30.143 3.296-23.444 12.667-39.43 23.032-48.498-80.557-9.156-165.246-40.28-165.246-179.297 0-39.604 14.135-71.988 37.342-97.348-3.731-9.178-16.18-46.063 3.556-96.009 0 0 30.46-9.754 99.76 37.19 28.937-8.048 59.97-12.071 90.823-12.211 30.807.14 61.843 4.165 90.822 12.21 69.26-46.944 99.663-37.189 99.663-37.189 19.792 49.946 7.34 86.831 3.61 96.01 23.25 25.359 37.29 57.742 37.29 97.347 0 139.366-84.82 170.033-165.637 179.013 13.026 11.2 24.628 33.342 24.628 67.182 0 48.498-.445 87.627-.445 99.521 0 9.702 6.535 20.988 24.945 17.444 144.03-48.067 247.881-183.95 247.881-344.175 0-200.378-162.442-362.798-362.802-362.798z" fill="#FFF"></path></svg></a></div> <div class="footer">Less interests, more interest.</div> <div class="copyright">Copyright © 2021 Leonhardt</div></footer></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close"></button> <button class="pswp__button pswp__button--share"></button> <button class="pswp__button pswp__button--fs"></button> <button class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left"></button> <button class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.e7b3748e.js" defer></script><script src="/assets/js/vendors~layout-Layout.713d0a7b.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.d598e2f1.js" defer></script><script src="/assets/js/page-ICS-PA心得.c9458328.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.1d2b5365.js" defer></script>
  </body>
</html>
