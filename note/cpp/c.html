<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>C语言 | My Documentations</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.b27f4404.css" as="style"><link rel="preload" href="/assets/js/app.ebdd7216.js" as="script"><link rel="preload" href="/assets/js/2.f48cadb2.js" as="script"><link rel="preload" href="/assets/js/17.73223cde.js" as="script"><link rel="prefetch" href="/assets/js/10.53cde7a9.js"><link rel="prefetch" href="/assets/js/11.f623d497.js"><link rel="prefetch" href="/assets/js/12.8e8512b9.js"><link rel="prefetch" href="/assets/js/13.42e6bb09.js"><link rel="prefetch" href="/assets/js/14.2cc5c62e.js"><link rel="prefetch" href="/assets/js/15.8fd8b16a.js"><link rel="prefetch" href="/assets/js/16.275f3a5b.js"><link rel="prefetch" href="/assets/js/18.ab20de8e.js"><link rel="prefetch" href="/assets/js/19.69c2dab7.js"><link rel="prefetch" href="/assets/js/20.8ef1446a.js"><link rel="prefetch" href="/assets/js/21.de978305.js"><link rel="prefetch" href="/assets/js/22.1b3b76bd.js"><link rel="prefetch" href="/assets/js/23.16b23281.js"><link rel="prefetch" href="/assets/js/24.f8213530.js"><link rel="prefetch" href="/assets/js/25.2a70b083.js"><link rel="prefetch" href="/assets/js/26.a31d3153.js"><link rel="prefetch" href="/assets/js/27.13cef54c.js"><link rel="prefetch" href="/assets/js/28.414c523f.js"><link rel="prefetch" href="/assets/js/29.22b1157a.js"><link rel="prefetch" href="/assets/js/3.f82e4ec7.js"><link rel="prefetch" href="/assets/js/30.435188ea.js"><link rel="prefetch" href="/assets/js/31.57b9d028.js"><link rel="prefetch" href="/assets/js/32.84497166.js"><link rel="prefetch" href="/assets/js/33.6102bcb5.js"><link rel="prefetch" href="/assets/js/34.4d2a62b5.js"><link rel="prefetch" href="/assets/js/35.78fb1d25.js"><link rel="prefetch" href="/assets/js/36.eea99416.js"><link rel="prefetch" href="/assets/js/37.ec5d01e3.js"><link rel="prefetch" href="/assets/js/38.a4d04114.js"><link rel="prefetch" href="/assets/js/39.1a0c266b.js"><link rel="prefetch" href="/assets/js/4.d1b6e8ed.js"><link rel="prefetch" href="/assets/js/40.07444e3b.js"><link rel="prefetch" href="/assets/js/41.76e921dd.js"><link rel="prefetch" href="/assets/js/42.3b2cf128.js"><link rel="prefetch" href="/assets/js/43.24de1fd7.js"><link rel="prefetch" href="/assets/js/44.1db9d67f.js"><link rel="prefetch" href="/assets/js/45.a05c4248.js"><link rel="prefetch" href="/assets/js/46.6bd8578f.js"><link rel="prefetch" href="/assets/js/47.49e818f3.js"><link rel="prefetch" href="/assets/js/48.29abdba1.js"><link rel="prefetch" href="/assets/js/49.2e8f7396.js"><link rel="prefetch" href="/assets/js/5.7d8c4629.js"><link rel="prefetch" href="/assets/js/50.ca7f27cb.js"><link rel="prefetch" href="/assets/js/6.3a2a2487.js"><link rel="prefetch" href="/assets/js/7.59c4f4c1.js"><link rel="prefetch" href="/assets/js/8.52bdec09.js"><link rel="prefetch" href="/assets/js/9.76c798b3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b27f4404.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/ChernoLogo.png" alt="My Documentations" class="logo"> <span class="site-name can-hide">My Documentations</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Note" class="dropdown-title"><span class="title">Note</span> <span class="arrow down"></span></button> <button type="button" aria-label="Note" class="mobile-dropdown-title"><span class="title">Note</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/algorithm/" class="nav-link">
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/note/cs/" class="nav-link">
  Computer Science
</a></li><li class="dropdown-item"><!----> <a href="/note/cpp/" class="nav-link router-link-active">
  C/C++
</a></li><li class="dropdown-item"><!----> <a href="/note/opengl/" class="nav-link">
  OpenGL
</a></li><li class="dropdown-item"><!----> <a href="/note/js/" class="nav-link">
  JavaScript
</a></li></ul></div></div><div class="nav-item"><a href="/hazel/" class="nav-link">
  Hazel
</a></div> <a href="https://github.com/kigane/MyBlogs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Note" class="dropdown-title"><span class="title">Note</span> <span class="arrow down"></span></button> <button type="button" aria-label="Note" class="mobile-dropdown-title"><span class="title">Note</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/algorithm/" class="nav-link">
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/note/cs/" class="nav-link">
  Computer Science
</a></li><li class="dropdown-item"><!----> <a href="/note/cpp/" class="nav-link router-link-active">
  C/C++
</a></li><li class="dropdown-item"><!----> <a href="/note/opengl/" class="nav-link">
  OpenGL
</a></li><li class="dropdown-item"><!----> <a href="/note/js/" class="nav-link">
  JavaScript
</a></li></ul></div></div><div class="nav-item"><a href="/hazel/" class="nav-link">
  Hazel
</a></div> <a href="https://github.com/kigane/MyBlogs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/note/cpp/" aria-current="page" class="sidebar-link">C++ 小知识</a></li><li><a href="/note/cpp/c.html" aria-current="page" class="active sidebar-link">C语言</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/cpp/c.html#union和匿名结构" class="sidebar-link">Union和匿名结构</a></li><li class="sidebar-sub-header"><a href="/note/cpp/c.html#getopt-int-argc-char-const-argv-const-char-optstring" class="sidebar-link">getopt(int argc, char const argv[], const char optstring)</a></li><li class="sidebar-sub-header"><a href="/note/cpp/c.html#readline" class="sidebar-link">readline</a></li><li class="sidebar-sub-header"><a href="/note/cpp/c.html#str系列" class="sidebar-link">str系列</a></li><li class="sidebar-sub-header"><a href="/note/cpp/c.html#scanf系列-printf系列" class="sidebar-link">scanf系列&amp;printf系列</a></li><li class="sidebar-sub-header"><a href="/note/cpp/c.html#regex系列" class="sidebar-link">regex系列</a></li><li class="sidebar-sub-header"><a href="/note/cpp/c.html#system" class="sidebar-link">system</a></li><li class="sidebar-sub-header"><a href="/note/cpp/c.html#popen-pclose" class="sidebar-link">popen/pclose</a></li></ul></li><li><a href="/note/cpp/cpp-random.html" class="sidebar-link">随机数</a></li><li><a href="/note/cpp/file-io.html" class="sidebar-link">C/C++ 文件 IO</a></li><li><a href="/note/cpp/macro.html" class="sidebar-link">宏</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="union和匿名结构"><a href="#union和匿名结构" class="header-anchor">#</a> Union和匿名结构</h2> <p>Union: 定义类似struct，但内存分配方式不一样。struct会为所有成员分配内存空间，union是所有成员共用一个内存空间，大小以最大的成员为准。
匿名：通常嵌套于union或strcut中，可以用外层类型的变量名直接访问匿名的结构成员。union中的匿名比较有用，因为可以将一系列成员包裹起来以获取更大的内存空间。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h&gt;</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">union</span>  
<span class="token punctuation">{</span>
    <span class="token keyword">union</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">uint32_t</span> _32<span class="token punctuation">;</span>
        <span class="token class-name">uint16_t</span> _16<span class="token punctuation">;</span>
        <span class="token class-name">uint8_t</span> _8<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> gpr<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 32B</span>

    <span class="token keyword">struct</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">uint32_t</span> eax<span class="token punctuation">,</span> ecx<span class="token punctuation">,</span> edx<span class="token punctuation">,</span> ebx<span class="token punctuation">,</span> esp<span class="token punctuation">,</span> ebp<span class="token punctuation">,</span> esi<span class="token punctuation">,</span> edi<span class="token punctuation">;</span>
        <span class="token class-name">uint64_t</span> pc<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 40B</span>
<span class="token punctuation">}</span> CPU<span class="token punctuation">;</span>


<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token keyword">const</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    CPU cpu<span class="token punctuation">;</span>
    cpu<span class="token punctuation">.</span>gpr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>_32 <span class="token operator">=</span> <span class="token number">666</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;CPU size: %d\n&quot;</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>CPU<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 40</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;cpu.eax: %d\n&quot;</span><span class="token punctuation">,</span> cpu<span class="token punctuation">.</span>eax<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 666</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="bitfield"><a href="#bitfield" class="header-anchor">#</a> bitfield</h3> <p>只能在struct或union中声明。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token punctuation">{</span>
      <span class="token comment">/* field 4 bits wide */</span>
      <span class="token keyword">unsigned</span> field1 <span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span>
      <span class="token comment">/*
       * unnamed 3 bit field
       * unnamed fields allow for padding
       */</span>
      <span class="token keyword">unsigned</span>        <span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">;</span>
      <span class="token comment">/*
       * one-bit field
       * can only be 0 or -1 in two's complement!
       */</span>
      <span class="token keyword">signed</span> field2   <span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token comment">/* align next field on a storage unit */</span>
      <span class="token keyword">unsigned</span>        <span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">unsigned</span> field3 <span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>full_of_fields<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li>1bit的有符号bitfield只能表示0和-1.</li> <li>bitfield可以用const，volatile修饰</li> <li>C不能保证机器内的字段的排序。标准没有定义，取决于机器和编译器的实现。</li> <li>要强制对准到存储单元边界，请在想要对齐的字段之前使用零宽度字段。</li> <li>gcc可能是从LSB开始分配的。</li></ul> <h2 id="getopt-int-argc-char-const-argv-const-char-optstring"><a href="#getopt-int-argc-char-const-argv-const-char-optstring" class="header-anchor">#</a> getopt(int argc, char* const argv[], const char* optstring)</h2> <p>选项处理过程</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">int</span> optind<span class="token punctuation">;</span> <span class="token comment">// argv中下一个要处理的元素的索引(初始为 1)</span>
<span class="token keyword">int</span> opterr<span class="token punctuation">;</span> <span class="token comment">// 是否输出错误信息</span>
<span class="token keyword">int</span> optopt<span class="token punctuation">;</span> <span class="token comment">// 导致错误的选项字符</span>
<span class="token keyword">char</span><span class="token operator">*</span> optarg<span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">option</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">;</span> <span class="token comment">// 长选项(--option)的名称</span>
    <span class="token keyword">int</span> has_arg<span class="token punctuation">;</span> <span class="token comment">// 0:无参数 1:有参数 2:参数可选</span>
    <span class="token keyword">int</span> <span class="token operator">*</span>flag<span class="token punctuation">;</span> <span class="token comment">// flag为NULL：getopt_long()返回val。否则getopt_long()返回0，flag指向的变量值为val(如果该option用户设置了的话)</span>
    <span class="token keyword">int</span> val<span class="token punctuation">;</span> <span class="token comment">// 返回值或放入flag</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 结构体数组的最后一个元素必须设为0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>如果getopt()找到下一个选项字符，就返回那个字符，更新optind和一个static变量nextchar</p> <p>optstring包含了所有合法的选项，如果字符后面跟着一个<code>:</code>，说明需要参数，两个说明是可选参数。<br>
如果选项中包含文本(-oarg, o 是选项，arg是文本)，则文本会保存在optarg中其他情况下，optarg设为0.
GNU扩展,optstring中的<code>W:</code>表示将<code>-W foo</code>看作<code>--foo</code>看待。</p> <p>默认情况下,getopt()按输入顺序排列argv的内容。所以，所有的非选项参数放在最后。
optstring的首字符决定使用的模式</p> <ul><li><code>+</code> 遇到任何一个非选项参数就终止选项处理</li> <li><code>-</code> 强制将所有非选项参数看作选项的参数
<code>--</code> 在任何模式下都可以强行终止选项处理过程。</li></ul> <p>Errors</p> <ul><li>处理的选项不再optstring中</li> <li>设置为有参数的选项没有检测到参数
处理</li> <li>默认输出错误信息，将导致错误的选项字符放在optopt中，函数返回 ?</li> <li>如果调用者将opterr设为0，则不会输出错误信息，函数仍返回 ?</li> <li>如果optstring的第一个字符(不包括描述模式的<code>+,-</code>)为<code>:</code>。函数同样不输出错误信息，并且在设为有参数的选项没有参数时返回值变为<code>:</code>，从而可以区别出这种情况。</li></ul> <p>getopt()返回值</p> <ul><li>如果所有的命令行选项都处理完了，则返回 -1.</li> <li>如果遇到没在optstring中指定的字符，返回 ?</li> <li>如果遇到选项丢失参数的情况，看optstring中的第一个字符，如果是<code>:</code> 则返回 <code>:</code>，否则返回 ?</li></ul> <p><code>int getopt_long(int argc, char* const argv[], const char* optstring, const struct option* longopts, int* longindex)</code></p> <p>getopt_long(),getopt_long_only()</p> <ul><li>当识别到短选项时，也返回值</li> <li>长选项，见flag注释。</li> <li>Error和-1和getopt()一样</li> <li>识别到模糊匹配和冗余参数会返回 ?</li> <li>longindex为longopts的索引，如果不为NULL的话</li></ul> <h2 id="readline"><a href="#readline" class="header-anchor">#</a> readline</h2> <p><code>char* readline(const char* prompt)</code><br>
GNU的命令行编辑接口。readline会从终端读入一行并返回，其参数prompt为命令行开头的提示符(例如gdb中的&quot;(gdb)&quot;)。其返回值不包括换行符，仅保留输入的文本。另外返回值使用malloc分配内存的，调用者需要手动free。</p> <h2 id="str系列"><a href="#str系列" class="header-anchor">#</a> str系列</h2> <p>strtok</p> <ul><li><code>char *strtok(char *str, const char *delim)</code>： 使用了static buffer，不是线程安全的。</li> <li><code>char *strtok_r(char *str, const char *delim, char **saveptr)</code>: 多线程安全</li> <li>这个函数用于将字符串分解为一系列非空token(子串)。第一次调用strtok时str是需要被分解的字符串，之后处理相同字符串时str必须为NULL。delim参数为用于分解的分隔符，可以指定多个字符为同一级分隔符。</li> <li>strtok内部有一个指针，该指针决定了每个token的起点。第一次调用时指向str的第一个字符，第二次调用时指向第一个分割符后第一个不是分割符的字符，如果找不到这样的字符，strtok返回NULL。</li> <li>每个token的终点为分隔符(会被替换为'\0')或null('\0')。</li> <li>strtok的返回值要么是非空字符串，要么是NULL。(例如,'aaa;bbb'分隔符为';',顺序调用strtok的返回值为 'aaa', 'bbb', NULL)</li></ul> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token keyword">const</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>str1<span class="token punctuation">,</span> <span class="token operator">*</span>str2<span class="token punctuation">,</span> <span class="token operator">*</span>token<span class="token punctuation">,</span> <span class="token operator">*</span>subtoken<span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>savaptr1<span class="token punctuation">,</span> <span class="token operator">*</span>saveptr2<span class="token punctuation">;</span>
    <span class="token keyword">int</span> j<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">!=</span> <span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">&quot;Usage: %s string delim subdelim\n&quot;</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> str1 <span class="token operator">=</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">,</span> str1 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        token <span class="token operator">=</span> <span class="token function">strtok_r</span><span class="token punctuation">(</span>str1<span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>savaptr1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;saveptr1 %d %s\n&quot;</span><span class="token punctuation">,</span> j<span class="token punctuation">,</span> savaptr1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 剩余未处理的部分</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>token <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d: %s\n&quot;</span><span class="token punctuation">,</span> j<span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span>str2 <span class="token operator">=</span> token<span class="token punctuation">;</span> <span class="token punctuation">;</span> str2 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            subtoken <span class="token operator">=</span> <span class="token function">strtok_r</span><span class="token punctuation">(</span>str2<span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>saveptr2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>subtoken <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot; --&gt; %s\n&quot;</span><span class="token punctuation">,</span> subtoken<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_SUCCESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><ul><li><code>size_t strlen(const char *s)</code>:返回字符串的长度，即string中有多少byte。不包含'\0'。</li> <li><code>size_t strnlen(const char *s, size_t max)</code>:返回字符串的长度，但不会超过最大值。</li> <li><code>int strcmp(const char *s1, const char *s2)</code>: 比较两个字符串是否相等。逐字符比较，如果第一个不相等的字符s1 &lt; s2，则返回负值，反之返回正值。都相等则返回0。</li> <li><code>int strncmp(const char *s1, const char *s2, size_t n)</code>:比较两个字符串是否相等，但只比前n个。</li> <li><code>int strcoll(const char *s1, const char *s2)</code>:比较两个字符串是否相等，基于程序当前的locale设置解释的字符串,locale的值为环境变量LC_COLLATE。</li> <li><code>char *strcpy(char *dest,const char *src)</code>: 复制字符串，包含最后的'\0'。dest需要足够大。返回dest指针。</li> <li><code>char *strncpy(char *dest,const char *src, size_t n)</code>:将src的前n个字符复制到dest。注意如果前n个字符中没有'\0'，则dest也不会添加，导致dest没有正常的终止符。如果n&gt;strlen(src)+1，剩下的字符会用'\0'补全。</li> <li><code>char *strcat(char *dest, const char *src)</code>: 将src(不包括'\0')连接到dest后，dest的'\0'会被覆盖，且会在整个字符串后添加一个'\0'。dest要足够大。</li> <li><code>char *strncat(char *dest, const char *src, size_t n)</code>:类似strcat。但最多使用src中的n个字符。另外，src可以没有'\0'。</li></ul> <h2 id="scanf系列-printf系列"><a href="#scanf系列-printf系列" class="header-anchor">#</a> scanf系列&amp;printf系列</h2> <ul><li><p><code>int scanf(const char *format, ...)</code></p></li> <li><p><code>int fscanf(FILE *stream, const char *format, ...)</code></p></li> <li><p><code>int sscanf(const char *str, const char *format, ...)</code></p></li> <li><p><code>sprintf, snprintf, fprintf</code></p></li> <li><p><code>int vscanf(const char *format, va_list ap)</code></p></li> <li><p><code>int vfscanf(FILE *stream, const char *format, va_list ap)</code></p></li> <li><p><code>int vsscanf(const char *str, const char *format, va_list ap)</code></p></li></ul> <p>format可能包含转换规约(%m.nf)，转换的结果被储存在format后的指针中，指针的类型要可format中的转换规约一致。如果format中的%数量多于指针参数的数量，则结果未定义。反之，则多余的指针参数会被忽略。</p> <ul><li>scanf从stdin读取输入。</li> <li>fscanf从指定的文件流stream中读取输入。</li> <li>sscanf从字符串str中读取输入。</li> <li>加v的读取变量参数列表(a variable arguemnt list)</li></ul> <p>返回值</p> <ul><li>成功：返回匹配的转换数</li> <li>失败：EOF</li></ul> <p>PS：format可以是变量而非双引号字符串。例如：打印程序的命令行参数。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>argc <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token punctuation">(</span>argc <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;%s &quot;</span> <span class="token operator">:</span> <span class="token string">&quot;%s&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token operator">++</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="转换规约"><a href="#转换规约" class="header-anchor">#</a> 转换规约</h3> <p>格式：<code>%#.#char</code> 其中第一个#为maximum field width。即最多匹配|输出的字符数。.#表示保留的小数点位数。char为转换说明符。
printf的格式串中</p> <ul><li>\NNN 最多3八进制数字，表示对应的ASCII字符</li> <li>\xHH 最多两个十六进制数字，表示对应的ASCII字符</li> <li>\uHHHH Unicode字符</li> <li>\UHHHHHHHH Unicode字符</li></ul> <p>输入</p> <ul><li>%: 匹配%。</li> <li>d: 匹配有符号十进制整数，对应的指针类型必须为int*。</li> <li>i: 匹配有符号整数，对应的指针类型必须为int*。用于scanf，如果输入的整数以0x开头，则以16进制读，以0开头，则以8进制读，否则以十进制读。</li> <li>o: 匹配无符号八进制整数。对应的指针类型必须为unsigned int*。</li> <li>u: 匹配无符号十进制整数。对应的指针类型必须为unsigned int*。</li> <li>x|X: 匹配无符号十六进制整数。对应的指针类型必须为unsigned int*。</li> <li>f | e | E | g | a: 匹配浮点数。对应的指针类型必须为float*。</li> <li>s: 匹配一连串字符，到空白符或字符数组满了(要留一个位置给自动加上的'\0')为止。对应的指针类型必须为char数组。</li> <li>%.5s: 表示从给定字符串中最多读5个字符。</li> <li>c: 匹配一个字符，不会加上'\0'。对应的指针类型必须为char*。</li> <li>[char set]: 匹配指定字符集中的字符。对应的指针类型必须为char*。特殊字符<code>]</code>，要匹配它，必须将它放在<code>[</code>后，要排除它，则需放在<code>^</code>后。 <code>-</code>必须放在字符集的开头或结尾。</li> <li>p: 匹配指针。对应的指针类型必须为void**。</li> <li>n: 没看懂</li></ul> <p>指针类型修改符</p> <ul><li><p>h: 针对diouxXn,将指针类型改为short int 或 unsigned short int。</p></li> <li><p>hh: signed char, unsigned char</p></li> <li><p>j: intmax_t,uintmax_t</p></li> <li><p>t: ptrdiff_t</p></li> <li><p>z: size_t</p></li> <li><p>l: signed long int, unsigned long int; 针对f,则指针类型变为double; 针对c,s，相关的指针类型被认为是wide charater?</p></li> <li><p>L: signed long long int, unsigned long long int; long long double</p></li> <li><p>m: %ms, %#mc 为输入字符串分配一块内存，指针类型改为char**。</p></li></ul> <p>输出
<a href="https://alvinalexander.com/programming/printf-format-cheat-sheet/" target="_blank" rel="noopener noreferrer">一些使用示例<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>// FLag characters</p> <ul><li>#: #必须紧跟在%后面，用于o，总是显示0####。用于x，总是显示0x####。用于[aAeEfFgG]，总是会显示小数点。注意：0,0x是被算进field  width的。</li> <li>0: 不足的位在左边用0补足。如果指定了浮点数的精度，则被忽略。</li> <li>-: 在maximum field width的左边界对齐。</li> <li>' ': 空格。有符号正数最前面放一个空格。</li> <li>+: 有符号正数前面加+。</li></ul> <p>// Sing Unix Specification</p> <ul><li><p>': 十进制数以千为单位加逗号。</p></li> <li><p>I: idu, 使用本地对应的字符输出。</p></li> <li><p>d,i:十进制有符号</p></li> <li><p>o,u,x,X</p></li> <li><p>e,E: [-]d.ddde[+-]dd</p></li> <li><p>f,F: 常见小数形式</p></li> <li><p>g,G: 看情况转换为f,e,F,G中的一种</p></li> <li><p>a,A: 十六进制的小数形式0xh.hhhp[+-]</p></li> <li><p>c</p></li> <li><p>s</p></li> <li><p>p</p></li> <li><p>n</p></li> <li><p>%</p></li></ul> <h3 id="号"><a href="#号" class="header-anchor">#</a> *号</h3> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%*d&quot;</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '      1223'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>*</code>在格式串中表示filed witdh和precision这两个部分使用下一个参数表示。<code>*</code>本身所在的<code>%</code>对应的参数则延后一位。<br>
在Single UNIX Specification中还有另一种等价表示。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%2$*1$d&quot;</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>其中<code>%2$</code>代替了<code>%</code>，<code>*2$</code>代替了<code>*</code>，<code>#$</code>代表使用对应的参数位置。值得一提的是，这种写法可以通过<code>#$</code>使用同一个变量。可惜，C99中没有这个功能。</p> <h2 id="regex系列"><a href="#regex系列" class="header-anchor">#</a> regex系列</h2> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;regex.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">regcomp</span><span class="token punctuation">(</span><span class="token class-name">regex_t</span> <span class="token operator">*</span>preg<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>regex<span class="token punctuation">,</span> <span class="token keyword">int</span> cflags<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">regexec</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">regex_t</span> <span class="token operator">*</span>preg<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>string<span class="token punctuation">,</span> <span class="token class-name">size_t</span> nmatch<span class="token punctuation">,</span>
            <span class="token class-name">regmatch_t</span> pmatch<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> eflags<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">size_t</span> <span class="token function">regerror</span><span class="token punctuation">(</span><span class="token keyword">int</span> errcode<span class="token punctuation">,</span> <span class="token class-name">regex_t</span> <span class="token operator">*</span>preg<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>errbuf<span class="token punctuation">,</span> <span class="token class-name">size_t</span> errbuf_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">regfree</span><span class="token punctuation">(</span><span class="token class-name">regex_t</span> <span class="token operator">*</span>preg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token class-name">regoff_t</span> rm_so<span class="token punctuation">;</span> <span class="token comment">// 匹配的子串开头位置</span>
    <span class="token class-name">regoff_t</span> rm_eo<span class="token punctuation">;</span> <span class="token comment">// 匹配子串的结尾位置，相对于子串开头。</span>
<span class="token punctuation">}</span> <span class="token class-name">regmatch_t</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>regcomp()用于将正则表达式编译为适用于后续regexec()搜索的形式。</p> <ul><li>preg 指针指向pattern buffer的储存区域</li> <li>regex 指针指向c风格字符串(the null-terminated string)</li> <li>cflags 用于决定编译的类型
<ul><li>REG_EXTENDED：使用POSIX扩展的正则表达式语法</li> <li>REG_ICASE: 忽略大小写</li> <li>REG_NOSUB: 不比报告匹配的位置。regexec()中的nmatch, pmatch参数会被忽略。</li> <li>REG_NEWLINE: <code>*</code>不会匹配 newline, <code>[^...]</code> 即使不包含newline，也不会匹配newline。紧跟在newline后<code>^</code>匹配空字符。newline前的<code>$</code>也立即匹配空字符。</li></ul></li> <li>eflags
<ul><li>REG_NOTBOL: <code>^</code>总是匹配失败。常用于一大堆字符串被拆分为多个子串分别传入regexec()处理。</li> <li>REG_NOTEOL: <code>$</code>总是匹配失败。</li></ul></li> <li>nmatch 匹配几个</li> <li>pmatch 匹配结果</li> <li>regcomp()返回0表示成功编译，其他为错误码。regexec返回0表示匹配成功，REG_NOMATCH表示匹配失败，其他为错误码。</li></ul> <p>所有的正则表达式的搜索都必须使用编译过的pattern buffer。因此regexec的preg参数必须是经过regcomp编译过的。
regerror()用于将regcomp()和regexec()的错误码转换为错误信息，存储在errbuf中。<br>
regfree()释放预编译的pattern buffer的内存。</p> <h2 id="system"><a href="#system" class="header-anchor">#</a> system</h2> <p><code>int system(const char *command);</code> 在 stdlib.h 中</p> <p>使用fork(2)创建子进程使用execl(3)执行command: execl(&quot;/bin/sh&quot;, &quot;sh&quot;, &quot;-c&quot;, command, (char *)NULL);</p> <h2 id="popen-pclose"><a href="#popen-pclose" class="header-anchor">#</a> popen/pclose</h2> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
FILE <span class="token operator">*</span><span class="token function">popen</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>command<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">pclose</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>popen() 通过创建一个管道打开一个进程。因为管道是单向的，所以type只能是r或w。</li> <li>popen() 的返回值是一个标准I/O流，必须用pclose()关闭。</li> <li>popen() type=w时，向返回的流中写相当于向command的标准输入写。type=r时，从流中读，相当于从command的标准输出中读。</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/cpp/" class="prev router-link-active">
        C++ 小知识
      </a></span> <span class="next"><a href="/note/cpp/cpp-random.html">
        随机数
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ebdd7216.js" defer></script><script src="/assets/js/2.f48cadb2.js" defer></script><script src="/assets/js/17.73223cde.js" defer></script>
  </body>
</html>
